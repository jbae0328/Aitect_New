<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Aitect_pilot</title>
    <base href="/Aitect_New/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="css/workspace-styles.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="Aitect_pilot.styles.css" rel="stylesheet" />
</head>
<body>
    <div id="app">Loading...</div>
    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ğŸ—™</a>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- í•µì‹¬ JS íŒŒì¼ë“¤ë§Œ ë¡œë“œ (ì¡´ì¬í•˜ëŠ” íŒŒì¼ë“¤ë§Œ) -->
    <!-- 1. ê¸°ë³¸ ë§¤ë‹ˆì €ë“¤ -->
    <script src="js/ui/status-manager.js"></script>

    <!-- 2. ë Œë”ë§ ì—”ì§„ -->
    <script src="js/core/three-renderer.js"></script>

    <!-- 3. ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ (ì¡´ì¬í•˜ëŠ” ê²ƒë§Œ) -->
    <script src="js/controls/camera-controller.js"></script>
    <script src="js/controls/mouse-handler.js"></script>
    <script src="js/controls/drag-manager.js"></script> <!-- ğŸ†• DragManager ì¶”ê°€ -->
    <!-- 4. ë„êµ¬ë“¤ (ì¡´ì¬í•˜ëŠ” ê²ƒë§Œ) -->
    <script src="js/tools/select-tool.js"></script>
    <script src="js/tools/line-tool.js"></script>
    <script src="js/tools/basic-tools.js"></script>
    <script src="js/tools/tool-manager.js"></script>

    <!-- 5. ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ (ì¸ë¼ì¸ìœ¼ë¡œ ë‹¨ìˆœí™”) -->
    <script>
        // ì „ì—­ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function () {
            console.log('=== Aitect ì‹œì‘ ===');

            // ê¸°ë³¸ ì „ì—­ í•¨ìˆ˜ë“¤ ì •ì˜
            window.setTool = function (tool) {
                console.log('setTool í˜¸ì¶œ:', tool);
                if (window.ToolManager && window.ToolManager.setTool) {
                    window.ToolManager.setTool(tool);
                }
            };

            window.clearAll = function () {
                console.log('clearAll í˜¸ì¶œ');
                if (window.ThreeRenderer && window.ThreeRenderer.clearAll) {
                    window.ThreeRenderer.clearAll();
                }
            };

            window.toggleGrid = function () {
                console.log('toggleGrid í˜¸ì¶œ');
                if (window.ThreeRenderer && window.ThreeRenderer.toggleGrid) {
                    window.ThreeRenderer.toggleGrid();
                }
            };

            window.fitToView = function () {
                console.log('fitToView í˜¸ì¶œ');
                if (window.CameraController && window.CameraController.resetView) {
                    window.CameraController.resetView();
                } else if (window.CameraController && window.CameraController.reset) {
                    window.CameraController.reset();
                }
            };

            // Blazor í˜¸í™˜ 3D ë·°ì–´ ì´ˆê¸°í™” í•¨ìˆ˜
            window.init3DViewer = function () {
                console.log('ğŸ¯ 3D ë·°ì–´ ì´ˆê¸°í™” ì‹œì‘');

                try {
                    // ì»¨í…Œì´ë„ˆ í™•ì¸
                    var container = document.getElementById('sketch-viewer');
                    if (!container) {
                        console.error('âŒ sketch-viewer ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        return;
                    }

                    // ì»¨í…Œì´ë„ˆ ì¤€ë¹„
                    container.id = 'threejs-container';
                    container.innerHTML = '';

                    // ThreeRenderer ì´ˆê¸°í™”
                    if (window.ThreeRenderer && window.ThreeRenderer.init) {
                        var success = window.ThreeRenderer.init('threejs-container');
                        if (success) {
                            console.log('âœ… ThreeRenderer ì´ˆê¸°í™” ì™„ë£Œ');

                            // CameraController ì´ˆê¸°í™”
                            if (window.CameraController && window.CameraController.init) {
                                window.CameraController.init();
                                console.log('âœ… CameraController ì´ˆê¸°í™” ì™„ë£Œ');
                            }

                            // DragManager ì´ˆê¸°í™” ğŸ†•
                            if (window.DragManager && window.DragManager.init) {
                                window.DragManager.init();
                                console.log('âœ… DragManager ì´ˆê¸°í™” ì™„ë£Œ');
                            }

                            // MouseHandler ì´ˆê¸°í™”
                            if (window.MouseHandler && window.MouseHandler.init) {
                                window.MouseHandler.init();
                                console.log('âœ… MouseHandler ì´ˆê¸°í™” ì™„ë£Œ');
                            }

                            // ToolManager ì´ˆê¸°í™”
                            if (window.ToolManager && window.ToolManager.init) {
                                window.ToolManager.init();
                                console.log('âœ… ToolManager ì´ˆê¸°í™” ì™„ë£Œ');
                            }

                            console.log('ğŸ‰ 3D ë·°ì–´ ì´ˆê¸°í™” ì„±ê³µ!');
                        } else {
                            console.error('âŒ ThreeRenderer ì´ˆê¸°í™” ì‹¤íŒ¨');
                        }
                    } else {
                        console.error('âŒ ThreeRendererë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    }
                } catch (error) {
                    console.error('âŒ 3D ë·°ì–´ ì´ˆê¸°í™” ì¤‘ ì—ëŸ¬:', error);
                }
            };

            console.log('âœ… ê¸°ë³¸ ì´ˆê¸°í™” ì™„ë£Œ');
        });
    </script>

    <!-- Blazor ì‹œì‘ (ë§ˆì§€ë§‰) -->
    <script src="_framework/blazor.webassembly.js"></script>
</body>
</html>